<div class="card">
  <h3>Programmes disponibles</h3>

  <input
    type="text"
    [(ngModel)]="searchText"
    placeholder="Rechercher un programme..."
    class="form-control search-bar"
  />

  <div class="button-row">


        <!-- ğŸŸ¦ Extraction de donnÃ©es -->
    <button (click)="extractData()" [disabled]="isLoading" class="extract-data-btn">
      <span *ngIf="isLoading" class="loader"></span>
      {{ isLoading ? 'Extraction en cours...' : 'ğŸŒ Extraire les donnÃ©es' }}
    </button>

    <!-- ğŸ”§ Ajout dâ€™un filtre personnalisÃ© pour les donnÃ©es -->
    <button (click)="openDataFilter()" [disabled]="isLoading" class="data-filter-btn">
      <span *ngIf="isLoading" class="loader"></span>
      {{ isLoading ? 'Extraction en cours...' : 'ğŸ”§ Filtre personnalisÃ© pour extraction des donnÃ©es' }}
    </button>

    <!-- ğŸŸ© Extraction de programmes -->
    <button (click)="extractPrograms()" [disabled]="isLoading" class="extract-prog-btn">
      <span *ngIf="isLoading" class="loader"></span>
      {{ isLoading ? 'Extraction en cours...' : 'ğŸŒ Extraire les programmes' }}
    </button>

    <!-- ğŸ”§ Filtre de Mise Ã  jour de la liste des programmes -->
    <button (click)="openProgramFilter()" [disabled]="isLoading" class="maj_prgrm-btn">
      <span *ngIf="isLoading" class="loader"></span>
      {{ isLoading ? 'Extraction en cours...' : 'ğŸ”§ Filtre personnalisÃ© pour la mise Ã  jour des programmes' }}
    </button>

  </div>

  <!-- ğŸŒ FenÃªtre filtre donnÃ©es -->
  <app-frontend-filter
    *ngIf="showDataFilter"
    (apply)="onDataFilterApplied($event)"
    (close)="showDataFilter = false">
  </app-frontend-filter>

  <!-- ğŸ§­ FenÃªtre filtre programmes -->
  <app-program-extraction-filter
    *ngIf="showProgramFilter"
    (apply)="onProgramFilterApplied($event)"
    (close)="showProgramFilter = false">
  </app-program-extraction-filter>
</div>

<!--message affichÃ© pour dÃ©bug et suivi des taches-->
<p>{{ message }}</p>

<!-- ğŸŒ Bandeau d'information sur la localisation -->
<div *ngIf="monitoringLocation" class="monitoring-banner">
  <div class="icon">ğŸ“</div>
  <div class="text">
    <strong>Programmes correspondant au lieu de surveillance :</strong><br />
    <span class="code">{{ monitoringLocation }}</span>
    <span *ngIf="monitoringLabel" class="label">({{ monitoringLabel }})</span>
  </div>
</div>





<!-- ğŸ“‹ Tableau des programmes avec cases Ã  cocher -->
<table class="programmes-table">
  <thead>
    <tr>
      <th>
        <input
          type="checkbox"
          [(ngModel)]="allSelected"
          (change)="toggleAll()"
        />
        Tout sÃ©lectionner
      </th>
      <th>Programme</th>
      <th>LibellÃ©</th>
      <th>Date de dÃ©but</th>
      <th>Ã‰tat</th>
      <th>Responsables</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let prog of filteredProgrammes">
      <td>
        <input type="checkbox" [(ngModel)]="prog.checked" name="{{ prog.name }}" />
      </td>
      <td>{{ prog.name }}</td>
      <td>{{ prog.libelle }}</td>
      <td>{{ prog.startDate || '' }}</td>
      <td>{{ prog.etat || '' }}</td>
      <td>{{ prog.responsable || '' }}</td>
    </tr>
  </tbody>
</table>

<!-- ğŸ“Š Fichiers CSV des programmes -->
<app-extracted-links
  [files]="extractedProgramFiles"
  title="Programmes extraits">
</app-extracted-links>

<!-- ğŸ“¦ Fichiers ZIP des donnÃ©es -->
<app-extracted-links
  [files]="extractedDataFiles"
  title="DonnÃ©es des programmes extraits">
</app-extracted-links>

<!-- ğŸ” Bouton relancer le filtrage seul -->
<button (click)="relancerFiltrageSeul()" [disabled]="isLoading" class="maj_prgrm-btn">
  <span *ngIf="isLoading" class="loader"></span>
  {{ isLoading ? 'Filtrage...' : 'ğŸ“Š Relancer uniquement le filtrage' }}
</button>
