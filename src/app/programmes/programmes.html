<div class="container">
  <div class="card p-4 mb-4 shadow-sm">
    <h3 class="mb-3">Programmes disponibles</h3>

    <!-- üîç Barre de recherche -->
    <mat-form-field appearance="outline" class="w-100 mb-3">
      <mat-label>Rechercher un programme</mat-label>
      <input matInput [(ngModel)]="searchText" placeholder="Nom du programme" />
    </mat-form-field>

    <!-- üéõÔ∏è Ligne de boutons -->
    <div class="d-flex flex-wrap justify-content-center gap-3 mb-4">

      <!-- üü¶ Extraction de donn√©es -->
      <button mat-raised-button color="primary"
              (click)="extractData()"
              [disabled]="isLoading">
        <mat-icon>cloud_download</mat-icon>
        Extraire les donn√©es
      </button>

      <!-- üß© Filtre pour extraction de donn√©es -->
      <button mat-raised-button class="button-success"
              (click)="openDataFilter()"
              [disabled]="isLoading">
        <mat-icon>tune</mat-icon>
        Filtre extraction donn√©es
      </button>

      <!-- üü© Extraction de programmes -->
      <button mat-raised-button color="primary"
              (click)="extractPrograms()"
              [disabled]="isLoading">
        <mat-icon>download</mat-icon>
        Extraire les programmes
      </button>

      <!-- üß≠ Filtre pour mise √† jour de programmes -->
      <button mat-raised-button class="button-success"
              (click)="openProgramFilter()"
              [disabled]="isLoading">
        <mat-icon>filter_alt</mat-icon>
        Filtre programmes
      </button>
    </div>

    <!-- üåê Filtres -->
    <app-frontend-filter
      *ngIf="showDataFilter"
      (apply)="onDataFilterApplied($event)"
      (close)="showDataFilter = false">
    </app-frontend-filter>

    <app-program-extraction-filter
      *ngIf="showProgramFilter"
      (apply)="onProgramFilterApplied($event)"
      (close)="showProgramFilter = false">
    </app-program-extraction-filter>
  </div>

  <!-- ü™Ñ Message d‚Äô√©tat -->
  <p class="text-center text-muted mb-3">{{ message }}</p>

  <!-- üåç Bandeau d'information sur la localisation -->
  <div *ngIf="monitoringLocation" class="monitoring-banner mb-4">
    <mat-icon color="primary">place</mat-icon>
    <div>
      <strong>Lieu de surveillance :</strong><br />
      <span class="code">{{ monitoringLocation }}</span>
      <span *ngIf="monitoringLabel" class="label">({{ monitoringLabel }})</span>
    </div>
  </div>

  <!-- üìã Tableau des programmes -->
  <div class="table-responsive mb-4">
    <table class="table table-bordered table-striped align-middle">
      <thead class="table-light text-center">
        <tr>
          <th>
            <input type="checkbox"
                   [(ngModel)]="allSelected"
                   (change)="toggleAll()" />
            Tout s√©lectionner
          </th>
          <th>Programme</th>
          <th>Libell√©</th>
          <th>Date de d√©but</th>
          <th>√âtat</th>
          <th>Responsables</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let prog of filteredProgrammes">
          <td class="text-center">
            <input type="checkbox"
                   [(ngModel)]="prog.checked"
                   name="{{ prog.name }}" />
          </td>
          <td>{{ prog.name }}</td>
          <td>{{ prog.libelle }}</td>
          <td>{{ prog.startDate || '' }}</td>
          <td>{{ prog.etat || '' }}</td>
          <td>{{ prog.responsable || '' }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- üìä Liens de fichiers extraits -->
  <app-extracted-links
    [files]="extractedProgramFiles"
    title="Programmes extraits">
  </app-extracted-links>

  <app-extracted-links
    [files]="extractedDataFiles"
    title="Donn√©es extraites">
  </app-extracted-links>

  <!-- üîÅ Relancer le filtrage seul -->
  <div class="text-center mt-4">
    <button mat-raised-button color="primary"
            (click)="relancerFiltrageSeul()"
            [disabled]="isLoading">
      <mat-icon>autorenew</mat-icon>
      Relancer uniquement le filtrage
    </button>
  </div>
</div>
