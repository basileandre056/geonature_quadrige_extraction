<div class="card">
  <h3>Programmes disponibles</h3>

  <input
    type="text"
    [(ngModel)]="searchText"
    placeholder="Rechercher un programme..."
    class="form-control search-bar"
  />

  <div class="button-row">
    <!-- bouton extraire données -->
    <button (click)="Extraire_donnees()" [disabled]="isLoading" class="extract-data-btn">
      {{ isLoading ? 'Extraction en cours...' : 'Extraire données' }}
    </button>

        <!-- bouton ajouter filtre données personnalisé -->
    <button (click)="showFilter = true" class="data-filter-btn">
      Ajouter un filtre personnalisé
    </button>

    <!-- bouton extraire programmes -->
    <button (click)="Extraire_programmes()" [disabled]="isLoading" class="extract-prog-btn">
      {{ isLoading ? 'Extraction en cours...' : 'Extraire programmes' }}
    </button>

    <!-- bouton maj programmes -->
    <button (click)="showExtractionFilter = true" [disabled]="isLoading" class="maj_prgrm-btn">
      {{ isLoading ? 'Mise à jour...' : 'Mettre à jour la liste des programmes' }}
    </button>
  </div>

  <!-- Fenêtre filtre classique -->
  <app-frontend-filter
    *ngIf="showFilter"
    (apply)="onFilterApplied($event)"
    (close)="showFilter = false">
  </app-frontend-filter>

  <!-- Fenêtre extraction programmes -->
  <app-program-extraction-filter
    *ngIf="showExtractionFilter"
    (apply)="onExtractionFilterApplied($event)"
    (close)="showExtractionFilter = false">
  </app-program-extraction-filter>
</div>

<p>{{ message }}</p>

<table class="programmes-table">
  <thead>
    <tr>
      <th>
        <input
          type="checkbox"
          [(ngModel)]="allSelected"
          (change)="toggleAll()"
        />
        Tout sélectionner
      </th>
      <th>Programme</th>
      <th>Libellé</th>
      <th>Date de début</th>
      <th>Etat</th>
      <th>Responsables</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let prog of filteredProgrammes">
      <td>
        <input type="checkbox" [(ngModel)]="prog.checked" name="{{ prog.name }}" />
      </td>
      <td>{{ prog.name }}</td>
      <td>{{ prog.libelle }}</td>
      <td>{{ prog.startDate || '' }}</td>
      <td>{{ prog.etat || '' }}</td>
      <td>{{ prog.responsable || '' }}</td>
    </tr>
  </tbody>
</table>

<!-- Fichiers CSV des programmes -->
<app-extracted-links [files]="extractedProgramFiles"></app-extracted-links>

<!-- Fichiers ZIP des données -->
<app-extracted-links [files]="extractedFiles"></app-extracted-links>


<!-- bouton maj des programmes -->

<!-- bouton relancer filtrage seul -->
<button (click)="relancer_filtrage_seul()" [disabled]="isLoading" class="maj_prgrm-btn">
  {{ isLoading ? 'Filtrage...' : 'Relancer uniquement le filtrage' }}
</button>

